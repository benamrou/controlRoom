<ROOT>
    <QUERY>
	WITH COUNTING AS
 (SELECT DINSITE,
         DINCININV,
         DINCODE,
         EINDINV,
         EINLIBL,
         DINCINR,
         DINCINL,
         DINSTRCINT,
         DINQTIN    QTY_REPORTED,
         DINSINF    THEO_QTY
    FROM INVDETINV@HEINENS_CUSTOM_PROD, INVENTINV@HEINENS_CUSTOM_PROD
   WHERE EINTINV = 42
     AND EINDINV >= TRUNC(SYSDATE - 2)
     AND DINCININV = EINCININV
     AND DINSINF != DINQTIN
     AND DINQTIN IS NOT NULL
     AND DINSITE = :param2)
SELECT DINSITE STORE_NUM,
       EINLIBL COUNTING_DESC,
       EINDINV COUNTING_DATE,
       DINCODE CODE_SCANNED,
       PKARTUV.GET_LIBELLE_LONG@HEINENS_CUSTOM_PROD(1, DINCINL, ''HN'') ITEM_DESC,
       (SELECT FOUCNUF
          FROM ARTUC@HEINENS_CUSTOM_PROD,
               RESEAU@HEINENS_CUSTOM_PROD,
               FOUDGENE@HEINENS_CUSTOM_PROD
         WHERE TRUNC(SYSDATE + 1) BETWEEN ARADDEB AND ARADFIN
           AND ARACINR = DINCINR
           AND RESSITE = DINSITE
           AND RESPERE = ARASITE
           AND TRUNC(SYSDATE + 1) BETWEEN RESDDEB AND RESDFIN
           AND ARACFIN = FOUCFIN
           AND ROWNUM = 1) SUPPLIER_CODE,
       (SELECT FOULIBL
          FROM ARTUC@HEINENS_CUSTOM_PROD,
               RESEAU@HEINENS_CUSTOM_PROD,
               FOUDGENE@HEINENS_CUSTOM_PROD
         WHERE TRUNC(SYSDATE + 1) BETWEEN ARADDEB AND ARADFIN
           AND ARACINR = DINCINR
           AND RESSITE = DINSITE
           AND RESPERE = ARASITE
           AND TRUNC(SYSDATE + 1) BETWEEN RESDDEB AND RESDFIN
           AND ARACFIN = FOUCFIN
           AND ROWNUM = 1) SUPPLIER_DESC,
       (SELECT SOBCEXT
          FROM STRUCOBJ@HEINENS_CUSTOM_PROD, STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE STRCINT = DINSTRCINT
           AND SOBCINT = STRPERE
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 3) DEPT_CODE,
       (SELECT PKSTRUCOBJ.GET_DESC@HEINENS_CUSTOM_PROD(1, STRPERE, ''HN'')
          FROM STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 3) DEPT_DESC,
       (SELECT SOBCEXT
          FROM STRUCOBJ@HEINENS_CUSTOM_PROD, STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE SOBCINT = STRPERE
           AND STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 2) SDEPT_CODE,
       (SELECT PKSTRUCOBJ.GET_DESC@HEINENS_CUSTOM_PROD(1, STRPERE, ''HN'')
          FROM STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 2) SDEPT_DESC,
       (SELECT SOBCEXT
          FROM STRUCOBJ@HEINENS_CUSTOM_PROD, STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE SOBCINT = STRPERE
           AND STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 1) CAT_CODE,
       (SELECT PKSTRUCOBJ.GET_DESC@HEINENS_CUSTOM_PROD(1, STRPERE, ''HN'')
          FROM STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 1) CAT_DESC,
       (SELECT SOBCEXT
          FROM STRUCOBJ@HEINENS_CUSTOM_PROD, STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE SOBCINT = STRPERE
           AND STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 0) SCAT_CODE,
       (SELECT PKSTRUCOBJ.GET_DESC@HEINENS_CUSTOM_PROD(1, STRPERE, ''HN'')
          FROM STRUCTURE@HEINENS_CUSTOM_PROD
         WHERE STRCINT = DINSTRCINT
           AND TRUNC(SYSDATE + 1) BETWEEN STRDDEB AND STRDFIN
           AND STRLEVEL = 0) SCAT_DESC,
       QTY_REPORTED,
       THEO_QTY,
       (SELECT ''YES''
          FROM ARTREAP@HEINENS_CUSTOM_PROD, RESEAU@HEINENS_CUSTOM_PROD
         WHERE TRUNC(SYSDATE + 1) BETWEEN AREDDEB AND AREDFIN
           AND ARECINL = DINCINL
           AND RESSITE = DINSITE
           AND RESPERE = ARESITE
           AND TRUNC(SYSDATE + 1) BETWEEN RESDDEB AND RESDFIN) CGO,
       (SELECT MAX(STMDMVT)
          FROM STOMVT@HEINENS_CUSTOM_PROD
         WHERE STMSITE = DINSITE
           AND STMTMVT = 150
           AND STMCINL = DINCINL) LAST_SALE
  FROM COUNTING T
 WHERE QTY_REPORTED != THEO_QTY
 ORDER BY STORE_NUM, CGO ASC
    </QUERY>
  <HEADERIFEMPTY>No discrepancy inventoryi vs. counting</HEADERIFEMPTY>
  <HEADER>Counted items with inventory discrepancies</HEADER>
  
</ROOT>

